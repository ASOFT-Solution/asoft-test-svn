@model IEnumerable<MyConnection.HoiVien>

@{
    ViewBag.Title = "Index";
}

<h2>Danh mục hội viên</h2>


    <table>
        <tr>
            <td>
                @Html.Raw("Đơn vị")
                @Html.Editor("donvi")
            </td>
            <td>
                @Html.Raw("Địa chỉ")
                @Html.Editor("diachi")
            </td>
            <td>
                @Html.Raw("Số điện thoại")
                @Html.Editor("sodienthoai")
            </td>
        </tr>
        <tr>
            <td>
                @Html.Raw("Mã hội viên")
                @Html.Editor("mahoivien")
            </td>
            <td>
                @Html.Raw("Mã số thuế/CMND")
                @Html.Editor("cmnd")
            </td>
            <td>
                @Html.Raw("Fax")
                @Html.Editor("fax")
            </td>
        </tr>
        <tr>
            <td>
                @Html.Raw("Tên hội viên")
                @Html.Editor("tenhoivien")
            </td>
            <td>
                @Html.Raw("Điện thoại di động")
                @Html.Editor("dtdd")
            </td>
            <td>
                @Html.Raw("Email")
                @Html.Editor("email")
            </td>
        </tr>
        <tr>
            <td>
            
            </td>
            <td>
                &nbsp
            </td>
            <td>
                <input id="submit" type="button" value="Lọc dữ liệu" onclick="locdulieu()" />
                <input type="button" value="Làm lại" onclick="lamlai()" />
            </td>
        </tr>
    </table>

    <p>
        <button onclick="them()">Thêm</button>
        <button onclick="xoa()">Xóa</button>
        <button onclick="disable()">Disable</button>
        <button onclick="enable()">Enable</button>
    </p>
@{int i = 1;}
<div id="grip">
    <table  style="text-align:center">
        <tr>
            <th>
                <input id="ck" name="ck" type="checkbox" onclick="checkall()"/>
            </th>
            <th>
                STT
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DivisionID)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MemberID)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MemberName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Address)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Identify)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Phone)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Tel)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Fax)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Email)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Disable)
            </th>
            <th></th>
        </tr>

    @foreach (var item in Model) {
        var ma = "ma" + i;
        <input type="hidden" id="@ma" value="@item.APK" />
        <tr>
             <th>
                 @{var id = "ck" + i;}
                <input type="checkbox" id="@id"/>
            </th>
             <td>
                @i
                @{i++;}
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.DivisionID)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.MemberID)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.MemberName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Address)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Identify)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Phone)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Tel)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Fax)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Email)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Disable)
            </td>
        </tr>
    }

    </table>
</div>
   


<script>
    var soluong = @i +0;
    function checkall() {
        var i = soluong;
        if (document.getElementById("ck").checked == true) {
            for(var k = 1; k < i ;k++)
            {
                var id = "ck" + k;
                document.getElementById(id).checked = true;
            }
        }
        else {
            for(var k = 1; k < i ;k++)
            {
                var id = "ck" + k;
                document.getElementById(id).checked = false;
            }
        }
    };

    function xoa() {
        if (!confirm("Bạn có chắc chắn muốn xóa?"))
        {
            return;
        }

        var i = soluong;
        var list = Array();
        var j = 0;
        for (var k = 1; k < i ; k++) {
            if (document.getElementById("ck" + k).checked == true) {
                list[j] = document.getElementById("ma" + k).value;
                j++;
            }
        };

        
        $.ajax({
            type: 'POST',
            url: '/asoft/xoa',
            traditional: true,
            dataType: "json",
            data: { dulieu: list },
            success: function (data) {

                alert("success");
                loadgrip(data);
            },
            error: function (args) {

                alert("Error on ajax post");
            }
        });

    };

    function them() {
        windowChild = window.open('/asoft/create', "windowChild", "width=500, height=700");
    };

    function lamlai() {
        document.getElementById("donvi").value = "";
        document.getElementById("diachi").value = "";
        document.getElementById("sodienthoai").value = "";
        document.getElementById("mahoivien").value = "";
        document.getElementById("cmnd").value = "";
        document.getElementById("fax").value = "";
        document.getElementById("tenhoivien").value = "";
        document.getElementById("dtdd").value = "";
        document.getElementById("email").value = "";
    };

    function disable() {
        if (!confirm("Bạn có chắc chắn muốn hủy kích hoạt?"))
        {
            return;
        }

        var i = soluong + 0;
        var list = Array();
        var j = 0;
        for (var k = 1; k < i ; k++) {
            if (document.getElementById("ck" + k).checked == true) {
                list[j] = document.getElementById("ma" + k).value;
                j++;
            }
        };

        
        $.ajax({
            type: 'POST',
            url: '/asoft/disable',
            traditional: true,
            dataType: "json",
            data: { dulieu: list },
            success: function (data) {
                alert("success");
                loadgrip(data);
            },
            error: function (args) {
                alert("Error on ajax post");
            }
        });
   
    };

    function enable() {
        if (!confirm("Bạn có chắc chắn muốn kích hoạt?"))
        {
            return;
        }

        var i = soluong + 0;
        var list = Array();
        var j = 0;
        for (var k = 1; k < i ; k++) {
            if (document.getElementById("ck" + k).checked == true) {
                list[j] = document.getElementById("ma" + k).value;
                j++;
            }
        };

        
        $.ajax({
            type: 'POST',
            url: '/asoft/enable',
            traditional: true,
            dataType: "json",
            data: { dulieu: list },
            success: function (data) {
                alert("success");
                loadgrip(data);
            },
            error: function (args) {

                alert("Error on ajax post");
            }
        });
    };

    function loadgrip(data)
    {
       
            $("#grip").empty();
            var html = "<table  style='text-align:center'>"+
        "<tr><th><input id='ck' name='ck' type='checkbox' onclick='checkall()'/></th><th>STT</th><th>"+
                "@Html.DisplayNameFor(model => model.DivisionID)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.MemberID)"+
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.MemberName)"+
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Address)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Identify)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Phone)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Tel)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Fax)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Email)" +
            "</th><th>"+
                "@Html.DisplayNameFor(model => model.Disable)" +
            "</th><th></th></tr>";
            
            var i = 1;
            $.each(data, function(entryIndex, entry) {
                var ma = "ma" + i;
                var id = "ck" + i;
                if(entry["DivisionID"]==null)entry["DivisionID"]="";
                if(entry["MemberID"]==null)entry["MemberID"]="";
                if(entry["MemberName"]==null)entry["MemberName"]="";
                if(entry["Address"]==null)entry["Address"]="";
                if(entry["Identify"]==null)entry["Identify"]="";
                if(entry["Phone"]==null)entry["Phone"]="";
                if(entry["Tell"]==null)entry["Tell"]="";
                if(entry["Fax"]==null)entry["Fax"]="";
                if(entry["Email"]==null)entry["Email"]="";
                if(entry["Disable"]==null)entry["Disable"]="";
                html += "<input type='hidden' id='"+ ma +"' value='"+ entry["APK"] +"' /><tr><th>"+
                "<input type='checkbox' id='"+ id +"'/><td>"+ i +"</td><td>"+
                entry["DivisionID"]+
            "</td><td>"+
                entry["MemberID"]+
            "</td><td>"+
                entry["MemberName"]+
            "</td><td>"+
                entry["Address"]+
            "</td><td>"+
                entry["Identify"]+
            "</td><td>"+
                entry["Phone"]+
            "</td><td>"+
                entry["Tell"]+
            "</td><td>"+
                entry["Fax"]+
            "</td><td>"+
                entry["Email"]+
            "</td><td>"+
                entry["Disable"]+
            "</td></tr>";
                i++;
            });
            soluong = i;
            $("#grip").append(html);

    };

    function locdulieu()
    {
        var list = Array();
        list.push(document.getElementById("donvi").value);
        list.push(document.getElementById("mahoivien").value);
        list.push(document.getElementById("tenhoivien").value);
        list.push(document.getElementById("diachi").value);
        list.push(document.getElementById("cmnd").value);
        list.push(document.getElementById("sodienthoai").value);
        list.push(document.getElementById("dtdd").value);
        list.push(document.getElementById("fax").value);
        list.push(document.getElementById("email").value);

        $.ajax({
            type: 'POST',
            url: '/asoft/gantempdata',
            traditional: true,
            dataType: "json",
            data: { dulieu: list },
            success: function (data) {
                loadgrip(data);
            },
            error: function (args) {

                alert("Error on ajax post");
            }
        });
    };
</script>