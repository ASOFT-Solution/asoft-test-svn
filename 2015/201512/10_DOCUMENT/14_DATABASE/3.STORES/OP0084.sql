IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[OP0084]') AND OBJECTPROPERTY(ID, N'IsProcedure') = 1)
DROP PROCEDURE [DBO].[OP0084]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






-- <Summary>
---- In so sánh đơn hàng sx (Customize cho An Phát)
-- <Param>
---- 
-- <Return>
---- 
-- <Reference>
---- 
-- <History>
---- Created by Tiểu Mai on 06/01/2016

CREATE PROCEDURE [dbo].[OP0084] 	
				@DivisionID AS NVARCHAR(50),		
				@FromSOrderID AS NVARCHAR(50),
				@ToSOrderID AS NVARCHAR(50)

AS
DECLARE @sSQL AS nvarchar(MAX)
DECLARE @sSQL1 AS nvarchar(MAX), @sSQL2 AS NVARCHAR(MAX)
DECLARE @CustomizeName INT
SET @CustomizeName  = (SELECT CustomerName FROM CustomerIndex)

IF @CustomizeName = 54
BEGIN
	SET @sSQL = 'SELECT OT2002.DivisionID, OT2002.SOrderID, OT2002.TransactionID, OT2002.InventoryID, OT2002.OrderQuantity, O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID,
	M37.MaterialID, M37.MaterialUnitID, M37.MaterialTypeID, M37.MaterialQuantity, M37.RateDecimalApp, M37.QuantityUnit, M37.MaterialAmount,
	M37.DS01ID, M37.DS02ID, M37.DS03ID, M37.DS04ID, M37.DS05ID, M37.DS06ID, M37.DS07ID, M37.DS08ID, M37.DS09ID, M37.DS10ID,
	M37.DS11ID, M37.DS12ID, M37.DS13ID, M37.DS14ID, M37.DS15ID, M37.DS16ID, M37.DS17ID, M37.DS18ID, M37.DS19ID, M37.DS20ID
	FROM OT2001
	INNER JOIN OT2002 ON OT2002.DivisionID = OT2001.DivisionID AND OT2002.SOrderID = OT2001.SOrderID
	LEFT JOIN OT8899 O99 ON O99.DivisionID = OT2002.DivisionID AND O99.VoucherID = OT2002.SOrderID AND O99.TransactionID  = OT2002.TransactionID and O99.TableID  = ''OT2002''
	LEFT JOIN MT0136 M36 ON M36.DivisionID = OT2002.DivisionID AND M36.ApportionID = OT2002.InheritVoucherID AND M36.TransactionID = OT2002.InheritTransactionID AND
					ISNULL(O99.S01ID,'''') = ISNULL(M36.S01ID,'''') AND 
					ISNULL(O99.S02ID,'''') = ISNULL(M36.S02ID,'''') AND 
					ISNULL(O99.S03ID,'''') = ISNULL(M36.S03ID,'''') AND 
					ISNULL(O99.S04ID,'''') = ISNULL(M36.S04ID,'''') AND 
					ISNULL(O99.S05ID,'''') = ISNULL(M36.S05ID,'''') AND 
					ISNULL(O99.S06ID,'''') = ISNULL(M36.S06ID,'''') AND 
					ISNULL(O99.S07ID,'''') = ISNULL(M36.S07ID,'''') AND 
					ISNULL(O99.S08ID,'''') = ISNULL(M36.S08ID,'''') AND 
					ISNULL(O99.S09ID,'''') = ISNULL(M36.S09ID,'''') AND 
					ISNULL(O99.S10ID,'''') = ISNULL(M36.S10ID,'''') AND 
					ISNULL(O99.S11ID,'''') = ISNULL(M36.S11ID,'''') AND 
					ISNULL(O99.S12ID,'''') = ISNULL(M36.S12ID,'''') AND 
					ISNULL(O99.S13ID,'''') = ISNULL(M36.S13ID,'''') AND 
					ISNULL(O99.S14ID,'''') = ISNULL(M36.S14ID,'''') AND 
					ISNULL(O99.S15ID,'''') = ISNULL(M36.S15ID,'''') AND 
					ISNULL(O99.S16ID,'''') = ISNULL(M36.S16ID,'''') AND 
					ISNULL(O99.S17ID,'''') = ISNULL(M36.S17ID,'''') AND 
					ISNULL(O99.S18ID,'''') = ISNULL(M36.S18ID,'''') AND 
					ISNULL(O99.S19ID,'''') = ISNULL(M36.S19ID,'''') AND 
					ISNULL(O99.S20ID,'''') = ISNULL(M36.S20ID,'''') 
	LEFT JOIN MT0137 M37 ON M37.DivisionID = M36.DivisionID AND M37.ProductID = M36.ProductID AND M37.ReTransactionID = M36.TransactionID
	
	WHERE OT2001.DivisionID = '''+ @DivisionID +''' AND 
				OT2001.SOrderID BETWEEN N'''+@FromSOrderID+''' AND N'''+@ToSOrderID+''' AND
				OT2001.OrderType = 0	'


	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WHERE NAME ='OV00841')
		EXEC ('CREATE VIEW OV00841  ---TAO BOI OP0084
			AS '+@sSQL)
	ELSE
		EXEC( 'ALTER VIEW OV00841  ---TAO BOI OP0084
			AS '+@sSQL)
		
	SET @sSQL = '	SELECT DISTINCT	OT2002.DivisionID, OT2001.SOrderID, OT2002.TransactionID, OT2001.VoucherTypeID, OT2001.VoucherNo, OT2001.OrderDate, 
				OT2001.ObjectID, 
				CASE WHEN ISNULL(OT2001.ObjectName,'''') = ''''  THEN AT1202.ObjectName ELSE OT2001.ObjectName end AS ObjectName,
				OT2002.InventoryID, InventoryName, AT1302.UnitID, UnitName, 
				OrderQuantity, OT2001.DepartmentID, 
				--InheritedQuantity,
				OT2001.PeriodID, 
				OT2002.Ana01ID, OT2002.Ana02ID, OT2002.Ana03ID, OT2002.Ana04ID, OT2002.Ana05ID, 
				OT1002_1.AnaName AS AnaName1,
				OT1002_2.AnaName AS AnaName2,
				OT1002_3.AnaName AS AnaName3,
				OT1002_4.AnaName AS AnaName4,
				OT1002_5.AnaName AS AnaName5,
				OT2002.nvarchar01,	OT2002.nvarchar02,	OT2002.nvarchar03,	OT2002.nvarchar04,	OT2002.nvarchar05,	
				OT2002.nvarchar06,	OT2002.nvarchar07,	OT2002.nvarchar08,	OT2002.nvarchar09,	OT2002.nvarchar10,
				OT2001.InheritSOrderID,
				AT1302.InventoryTypeID,
				OT2002.InheritVoucherID,
				OT2002.InheritTransactionID,
				OT2002.Description,
				M02.PlanQuantity, 
				O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID, 
				O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID, 
				M37.MaterialID, M37.MaterialUnitID, M37.MaterialTypeID, M37.MaterialQuantity, M37.QuantityUnit, M37.Rate, M37.RateDecimalApp, M37.RateWastage, M37.MaterialPrice, 
				M37.MaterialAmount, M37.MaterialGroupID, 
				M37.DS01ID, M37.DS02ID, M37.DS03ID, M37.DS04ID, M37.DS05ID, M37.DS06ID, M37.DS07ID, M37.DS08ID, M37.DS09ID, M37.DS10ID, 
				M37.DS11ID, M37.DS12ID, M37.DS13ID, M37.DS14ID, M37.DS15ID, M37.DS16ID, M37.DS17ID, M37.DS18ID, M37.DS19ID, M37.DS20ID	'
		
	SET @sSQL1 = '			
		FROM	OT2002 
		LEFT JOIN AT1302 ON AT1302.InventoryID = OT2002.InventoryID AND AT1302.DivisionID = OT2002.DivisionID
		LEFT JOIN OT1003 ON OT1003.MethodID = OT2002.MethodID  AND OT1003.DivisionID = OT2002.DivisionID
		INNER JOIN OT2001 ON OT2001.SOrderID = OT2002.SOrderID AND OT2001.DivisionID = OT2002.DivisionID
		LEFT JOIN OT2001 Inherit_OT2001 ON Inherit_OT2001.InheritSOrderID = OT2002.SOrderID AND Inherit_OT2001.DivisionID = OT2002.DivisionID	
		LEFT JOIN AT1303 ON AT1303.WareHouseID = OT2002.WareHouseID AND AT1303.DivisionID = OT2001.DivisionID 
		LEFT JOIN AT1102 ON AT1102.DepartmentID = OT2001.DepartmentID  AND AT1102.DivisionID = OT2001.DivisionID
		LEFT JOIN AT1301 ON AT1301.InventoryTypeID = OT2001.InventoryTypeID AND AT1301.DivisionID = OT2002.DivisionID
		LEFT JOIN AT1304 ON AT1304.UnitID = AT1302.UnitID AND AT1304.DivisionID = OT2002.DivisionID
		--LEFT JOIN AT1103 ON AT1103.EmployeeID = OT2001.EmployeeID AND AT1103.DivisionID = OT2001.DivisionID 
		--LEFT JOIN AT1103 AT1103_2 on AT1103_2.EmployeeID = OT2001.SalesManID AND AT1103_2.DivisionID = OT2001.DivisionID
		LEFT JOIN AT1202 ON AT1202.ObjectID = OT2001.ObjectID AND AT1202.DivisionID = OT2002.DivisionID
		LEFT JOIN AT1011 OT1002_1 ON OT1002_1.AnaID = OT2002.Ana01ID AND  OT1002_1.AnaTypeID = ''A01''  AND OT1002_1.DivisionID = OT2002.DivisionID
		LEFT JOIN AT1011 OT1002_2 ON OT1002_2.AnaID = OT2002.Ana02ID AND  OT1002_2.AnaTypeID = ''A02''  AND OT1002_2.DivisionID = OT2002.DivisionID
		LEFT JOIN AT1011 OT1002_3 ON OT1002_3.AnaID = OT2002.Ana03ID AND  OT1002_3.AnaTypeID = ''A03''  AND OT1002_3.DivisionID = OT2002.DivisionID
		LEFT JOIN AT1011 OT1002_4 ON OT1002_4.AnaID = OT2002.Ana04ID AND  OT1002_4.AnaTypeID = ''A04''  AND OT1002_4.DivisionID = OT2002.DivisionID
		LEFT JOIN AT1011 OT1002_5 ON OT1002_5.AnaID = OT2002.Ana05ID AND  OT1002_5.AnaTypeID = ''A05'' AND OT1002_5.DivisionID = OT2002.DivisionID
		LEFT JOIN OT8899 O99 ON O99.DivisionID = OT2002.DivisionID AND O99.VoucherID = OT2002.SOrderID AND O99.TransactionID  = OT2002.TransactionID and O99.TableID  = ''OT2002''
		LEFT JOIN MT0136 M36 ON M36.DivisionID = OT2001.DivisionID AND M36.ApportionID = OT2001.InheritApportionID  AND M36.ProductID = OT2002.InventoryID AND
						ISNULL(O99.S01ID,'''') = ISNULL(M36.S01ID,'''') AND 
						ISNULL(O99.S02ID,'''') = ISNULL(M36.S02ID,'''') AND 
						ISNULL(O99.S03ID,'''') = ISNULL(M36.S03ID,'''') AND 
						ISNULL(O99.S04ID,'''') = ISNULL(M36.S04ID,'''') AND 
						ISNULL(O99.S05ID,'''') = ISNULL(M36.S05ID,'''') AND 
						ISNULL(O99.S06ID,'''') = ISNULL(M36.S06ID,'''') AND 
						ISNULL(O99.S07ID,'''') = ISNULL(M36.S07ID,'''') AND 
						ISNULL(O99.S08ID,'''') = ISNULL(M36.S08ID,'''') AND 
						ISNULL(O99.S09ID,'''') = ISNULL(M36.S09ID,'''') AND 
						ISNULL(O99.S10ID,'''') = ISNULL(M36.S10ID,'''') AND 
						ISNULL(O99.S11ID,'''') = ISNULL(M36.S11ID,'''') AND 
						ISNULL(O99.S12ID,'''') = ISNULL(M36.S12ID,'''') AND 
						ISNULL(O99.S13ID,'''') = ISNULL(M36.S13ID,'''') AND 
						ISNULL(O99.S14ID,'''') = ISNULL(M36.S14ID,'''') AND 
						ISNULL(O99.S15ID,'''') = ISNULL(M36.S15ID,'''') AND 
						ISNULL(O99.S16ID,'''') = ISNULL(M36.S16ID,'''') AND 
						ISNULL(O99.S17ID,'''') = ISNULL(M36.S17ID,'''') AND 
						ISNULL(O99.S18ID,'''') = ISNULL(M36.S18ID,'''') AND		
						ISNULL(O99.S19ID,'''') = ISNULL(M36.S19ID,'''') AND 
						ISNULL(O99.S20ID,'''') = ISNULL(M36.S20ID,'''') '
		SET @sSQL2 = '				
		LEFT JOIN MT0137 M37 ON M37.DivisionID = M36.DivisionID AND M37.ProductID = M36.ProductID AND M37.ReTransactionID = M36.TransactionID
		LEFT JOIN MT2001 M01 ON M01.DivisionID = OT2001.DivisionID AND M01.SOderID = OT2001.SOrderID
		LEFT JOIN MT2002 M02 ON M02.DivisionID = M01.DivisionID AND M02.PlanID = M01.PlanID
		LEFT JOIN MT8899 M89 ON M89.DivisionID = M02.DivisionID AND M89.VoucherID = M02.PlanID AND M89.TransactionID = M02.PlanDetailID AND
						ISNULL(O99.S01ID,'''') = ISNULL(M89.S01ID,'''') AND 
						ISNULL(O99.S02ID,'''') = ISNULL(M89.S02ID,'''') AND 
						ISNULL(O99.S03ID,'''') = ISNULL(M89.S03ID,'''') AND 
						ISNULL(O99.S04ID,'''') = ISNULL(M89.S04ID,'''') AND 
						ISNULL(O99.S05ID,'''') = ISNULL(M89.S05ID,'''') AND 
						ISNULL(O99.S06ID,'''') = ISNULL(M89.S06ID,'''') AND 
						ISNULL(O99.S07ID,'''') = ISNULL(M89.S07ID,'''') AND 
						ISNULL(O99.S08ID,'''') = ISNULL(M89.S08ID,'''') AND 
						ISNULL(O99.S09ID,'''') = ISNULL(M89.S09ID,'''') AND 
						ISNULL(O99.S10ID,'''') = ISNULL(M89.S10ID,'''') AND 
						ISNULL(O99.S11ID,'''') = ISNULL(M89.S11ID,'''') AND 
						ISNULL(O99.S12ID,'''') = ISNULL(M89.S12ID,'''') AND 
						ISNULL(O99.S13ID,'''') = ISNULL(M89.S13ID,'''') AND 
						ISNULL(O99.S14ID,'''') = ISNULL(M89.S14ID,'''') AND 
						ISNULL(O99.S15ID,'''') = ISNULL(M89.S15ID,'''') AND 
						ISNULL(O99.S16ID,'''') = ISNULL(M89.S16ID,'''') AND 
						ISNULL(O99.S17ID,'''') = ISNULL(M89.S17ID,'''') AND 
						ISNULL(O99.S18ID,'''') = ISNULL(M89.S18ID,'''') AND 
						ISNULL(O99.S19ID,'''') = ISNULL(M89.S19ID,'''') AND 
						ISNULL(O99.S20ID,'''') = ISNULL(M89.S20ID,'''')			
		WHERE	OT2001.DivisionID = '''+ @DivisionID +''' AND 
				OT2001.InheritSOrderID BETWEEN N'''+@FromSOrderID+''' AND N'''+@ToSOrderID+''' AND
				OT2001.OrderType = 1'		

	--PRINT @sSQL
	--PRINT @sSQL1
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WHERE NAME ='OV00842')
		EXEC ('CREATE VIEW OV00842  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1+@sSQL2)
	ELSE
		EXEC( 'ALTER VIEW OV00842  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1+@sSQL2)

	SET @sSQL = 'SELECT A07.DivisionID, A07.InventoryID, SUM(A07.ActualQuantity) AS ActualQuantity, A07.Ana05ID, W96.MOrderID as SOrderID, W96.OTransactionID,
						O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
						O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
	FROM AT2007 A07
	INNER JOIN AT2006 A06 ON A06.DivisionID = A07.DivisionID AND A06.VoucherID = A07.VoucherID
	LEFT JOIN WT0096 W96 ON W96.DivisionID = A07.DivisionID AND W96.VoucherID = A07.InheritVoucherID AND W96.TransactionID = A07.InheritTransactionID
	LEFT JOIN WT8899 O99 ON O99.DivisionID = A07.DivisionID AND O99.VoucherID = A07.VoucherID AND O99.TransactionID = A07.TransactionID AND O99.TableID = ''AT2007''
	WHERE W96.DivisionID = '''+ @DivisionID +'''
	GROUP BY A07.DivisionID, A07.InventoryID, A07.ActualQuantity, A07.Ana05ID, W96.MOrderID, W96.OTransactionID, 
	O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID	'

	--PRINT @sSQL
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WHERE NAME ='OV00843')
		EXEC ('CREATE VIEW OV00843  ---TAO BOI OP0084
			AS '+@sSQL)
	ELSE
		EXEC( 'ALTER VIEW OV00843  ---TAO BOI OP0084
			AS '+@sSQL)

	SET @sSQL = '
	SELECT O41.DivisionID, O41.SOrderID, O41.TransactionID, O41.InventoryID, AT1302.InventoryName, O41.OrderQuantity, 
	O41.S01ID, O41.S02ID, O41.S03ID, O41.S04ID, O41.S05ID, O41.S06ID, O41.S07ID, O41.S08ID, O41.S09ID, O41.S10ID,
	O41.S11ID, O41.S12ID, O41.S13ID, O41.S14ID, O41.S15ID, O41.S16ID, O41.S17ID, O41.S18ID, O41.S19ID, O41.S20ID,
	O41.MaterialID, A32.InventoryName as MaterialName, O41.MaterialUnitID, O41.MaterialTypeID, O41.MaterialQuantity, O41.RateDecimalApp AS RateDecimalAppSO, O41.QuantityUnit as QuantityUnitSO, O41.MaterialAmount,
	O41.DS01ID, O41.DS02ID, O41.DS03ID, O41.DS04ID, O41.DS05ID, O41.DS06ID, O41.DS07ID, O41.DS08ID, O41.DS09ID, O41.DS10ID,
	O41.DS11ID, O41.DS12ID, O41.DS13ID, O41.DS14ID, O41.DS15ID, O41.DS16ID, O41.DS17ID, O41.DS18ID, O41.DS19ID, O41.DS20ID,
	O42.PlanQuantity, O42.QuantityUnit as QuantityUnitSX, O42.RateDecimalApp AS RateDecimalAppSX, O43.ActualQuantity, O43.Ana05ID
	'
	SET @sSQL1 = '
	FROM OV00841 O41
	LEFT JOIN OV00842 O42 ON O42.DivisionID = O41.DivisionID AND O42.InheritVoucherID = O41.SOrderID AND O42.InheritTransactionID = O41.TransactionID AND
						ISNULL(O41.DS01ID,'''') = ISNULL(O42.DS01ID,'''') AND 
						ISNULL(O41.DS02ID,'''') = ISNULL(O42.DS02ID,'''') AND 
						ISNULL(O41.DS03ID,'''') = ISNULL(O42.DS03ID,'''') AND 
						ISNULL(O41.DS04ID,'''') = ISNULL(O42.DS04ID,'''') AND 
						ISNULL(O41.DS05ID,'''') = ISNULL(O42.DS05ID,'''') AND 
						ISNULL(O41.DS06ID,'''') = ISNULL(O42.DS06ID,'''') AND 
						ISNULL(O41.DS07ID,'''') = ISNULL(O42.DS07ID,'''') AND 
						ISNULL(O41.DS08ID,'''') = ISNULL(O42.DS08ID,'''') AND 
						ISNULL(O41.DS09ID,'''') = ISNULL(O42.DS09ID,'''') AND 
						ISNULL(O41.DS10ID,'''') = ISNULL(O42.DS10ID,'''') AND 
						ISNULL(O41.DS11ID,'''') = ISNULL(O42.DS11ID,'''') AND 
						ISNULL(O41.DS12ID,'''') = ISNULL(O42.DS12ID,'''') AND 
						ISNULL(O41.DS13ID,'''') = ISNULL(O42.DS13ID,'''') AND 
						ISNULL(O41.DS14ID,'''') = ISNULL(O42.DS14ID,'''') AND 
						ISNULL(O41.DS15ID,'''') = ISNULL(O42.DS15ID,'''') AND 
						ISNULL(O41.DS16ID,'''') = ISNULL(O42.DS16ID,'''') AND 
						ISNULL(O41.DS17ID,'''') = ISNULL(O42.DS17ID,'''') AND 
						ISNULL(O41.DS18ID,'''') = ISNULL(O42.DS18ID,'''') AND 
						ISNULL(O41.DS19ID,'''') = ISNULL(O42.DS19ID,'''') AND 
						ISNULL(O41.DS20ID,'''') = ISNULL(O42.DS20ID,'''')
	LEFT JOIN OV00843 O43 ON O43.DivisionID = O43.DivisionID AND O43.SOrderID = O42.SOrderID AND O43.OTransactionID = O42.TransactionID AND O43.InventoryID = O41.MaterialID AND
						ISNULL(O41.DS01ID,'''') = ISNULL(O43.S01ID,'''') AND 
						ISNULL(O41.DS02ID,'''') = ISNULL(O43.S02ID,'''') AND 
						ISNULL(O41.DS03ID,'''') = ISNULL(O43.S03ID,'''') AND 
						ISNULL(O41.DS04ID,'''') = ISNULL(O43.S04ID,'''') AND 
						ISNULL(O41.DS05ID,'''') = ISNULL(O43.S05ID,'''') AND 
						ISNULL(O41.DS06ID,'''') = ISNULL(O43.S06ID,'''') AND 
						ISNULL(O41.DS07ID,'''') = ISNULL(O43.S07ID,'''') AND 
						ISNULL(O41.DS08ID,'''') = ISNULL(O43.S08ID,'''') AND 
						ISNULL(O41.DS09ID,'''') = ISNULL(O43.S09ID,'''') AND 
						ISNULL(O41.DS10ID,'''') = ISNULL(O43.S10ID,'''') AND 
						ISNULL(O41.DS11ID,'''') = ISNULL(O43.S11ID,'''') AND 
						ISNULL(O41.DS12ID,'''') = ISNULL(O43.S12ID,'''') AND 
						ISNULL(O41.DS13ID,'''') = ISNULL(O43.S13ID,'''') AND 
						ISNULL(O41.DS14ID,'''') = ISNULL(O43.S14ID,'''') AND 
						ISNULL(O41.DS15ID,'''') = ISNULL(O43.S15ID,'''') AND 
						ISNULL(O41.DS16ID,'''') = ISNULL(O43.S16ID,'''') AND 
						ISNULL(O41.DS17ID,'''') = ISNULL(O43.S17ID,'''') AND 
						ISNULL(O41.DS18ID,'''') = ISNULL(O43.S18ID,'''') AND 
						ISNULL(O41.DS19ID,'''') = ISNULL(O43.S19ID,'''') AND 
						ISNULL(O41.DS20ID,'''') = ISNULL(O43.S20ID,'''')
	LEFT JOIN AT1302 ON AT1302.DivisionID = O41.DivisionID AND AT1302.InventoryID = O41.InventoryID
	LEFT JOIN AT1302 A32 ON A32.DivisionID = O41.DivisionID AND A32.InventoryID = O41.MaterialID
	'

	--PRINT @sSQL
	--PRINT @sSQL1
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WHERE NAME ='OV0084')
		EXEC ('CREATE VIEW OV0084  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1)
	ELSE
		EXEC( 'ALTER VIEW OV0084  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1)
	
END
GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

